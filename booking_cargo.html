<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª | Ø§Ù„Ø­ÙˆØª ğŸ‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #FFFFFF; margin: 0; padding: 0; }
        
        /* Ø§Ù„Ø§Ù†Ø­Ù†Ø§Ø¡ Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© */
        .top-curve {
            background: #8B5CF6; 
            height: 180px;
            border-radius: 0 0 50% 50% / 0 0 20% 20%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .truck-icon { width: 80px; margin-bottom: 10px; }

        /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠØ© Ø§Ù„ÙØ§ØªØ­Ø© Ù„Ù„Ø®Ø±ÙŠØ·Ø© */
        .map-section {
            background-color: #F1F5F9;
            border-radius: 2.5rem;
            padding: 20px;
            margin-top: 20px;
        }

        .map-box { 
            height: 180px; 
            border-radius: 1.5rem; 
            border: 2px solid white; 
            margin: 15px 0;
            z-index: 1;
        }

        /* Ø²Ø± Ø§Ù„Ø£Ø±Ø¬ÙˆØ§Ù†ÙŠ Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© */
        .btn-purple {
            background-color: #8B5CF6;
            color: white;
            width: 100%;
            padding: 15px;
            border-radius: 1.2rem;
            font-weight: 900;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 10px 15px -3px rgba(139, 92, 246, 0.3);
        }

        .input-card {
            background: white;
            border: 2px solid #FFD700;
            border-radius: 1rem;
            padding: 10px 15px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .label-text { color: #94a3b8; font-size: 0.75rem; font-weight: 800; margin-bottom: 2px; display: block; }
        .input-draw { border: none; outline: none; width: 100%; font-weight: 900; color: #1e293b; }
    </style>
</head>
<body>

    <div class="top-curve">
        <img src="https://cdn-icons-png.flaticon.com/512/411/411763.png" class="truck-icon" alt="truck">
        <h1 class="text-white text-2xl font-black">ØªØ£Ø¨ÙØ¯ ÙƒÙØªØ§Ø± Ø£Ø¯ÙØ´ Ù…Ù†ÙŠÙ†</h1> </div>

    <main class="px-6 -mt-10 pb-10">
        <p class="text-center text-gray-400 text-xs font-bold mb-4">Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨</p>
        
        <div class="grid grid-cols-2 gap-3 mb-6">
            <div class="input-card">
                <label class="label-text">ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                <input type="text" id="custName" placeholder="Ø£ÙƒØªØ¨ Ù‡Ù†Ø§" class="input-draw text-sm">
            </div>
            <div class="input-card">
                <label class="label-text">ğŸ“ Ø±Ù‚Ù… (ÙˆØ§ØªØ³Ø§Ø¨)</label>
                <input type="tel" id="custPhone" placeholder="077..." class="input-draw text-sm text-left" dir="ltr">
            </div>
        </div>

        <div class="map-section">
            <h3 class="text-center font-black text-indigo-900 text-sm">ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù„Ù‚Ø§Ø¡ (Ù…Ù†ÙŠÙ†ØŸ):</h3>
            <div id="mapStart" class="map-box"></div>
            <button onclick="getLocation('start')" class="btn-purple text-xs py-3">ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ ğŸ›°ï¸</button>
        </div>

        <div class="map-section">
            <h3 class="text-center font-black text-indigo-900 text-sm">ğŸ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ³Ù„ÙŠÙ… (Ù„ÙˆÙŠÙ†ØŸ):</h3>
            <div id="mapEnd" class="map-box"></div>
            <button onclick="getLocation('end')" class="btn-purple text-xs py-3">ØªØ­Ø¯ÙŠØ¯ ÙˆØ¬Ù‡Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ… ğŸ›°ï¸</button>
        </div>

        <div class="mt-8">
            <button onclick="confirmCargo()" class="btn-main btn-purple">
                Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª <i class="fas fa-chevron-left"></i>
            </button>
        </div>
    </main>

    <script>
        let mapStart, markerStart, mapEnd, markerEnd;
        const u = new URLSearchParams(window.location.search);

        window.onload = function() {
            // Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            mapStart = L.map('mapStart', {zoomControl: false}).setView([35.4687, 44.3921], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mapStart);
            markerStart = L.marker([35.4687, 44.3921], {draggable: true}).addTo(mapStart);

            // Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
            mapEnd = L.map('mapEnd', {zoomControl: false}).setView([35.4687, 44.3921], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mapEnd);
            markerEnd = L.marker([35.4687, 44.3921], {draggable: true}).addTo(mapEnd);
        };

        function getLocation(type) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const c = [pos.coords.latitude, pos.coords.longitude];
                    if(type === 'start') { mapStart.setView(c, 16); markerStart.setLatLng(c); }
                    else { mapEnd.setView(c, 16); markerEnd.setLatLng(c); }
                });
            }
        }

        function confirmCargo() {
            const name = document.getElementById('custName').value;
            const phone = document.getElementById('custPhone').value;
            if(!name || !phone) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ğŸ‹");

            u.set('name', name);
            u.set('phone', phone);
            u.set('slat', markerStart.getLatLng().lat); u.set('slng', markerStart.getLatLng().lng);
            u.set('elat', markerEnd.getLatLng().lat); u.set('elng', markerEnd.getLatLng().lng);
            u.set('vehicle', 'Ø³ÙŠØ§Ø±Ø© Ø­Ù…Ù„ ğŸš›');

            window.location.href = `review.html?${u.toString()}`;
        }
    </script>
</body>
</html>
