<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø¬Ø² Ø³ÙŠØ§Ø±Ø© Ø­Ù…Ù„ | Ø§Ù„Ø­ÙˆØª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #fefce8; }
        #map { height: 300px; border-radius: 2rem; border: 4px solid white; z-index: 1; }
    </style>
</head>
<body class="p-4 md:p-8 text-right">
    <div class="max-w-2xl mx-auto bg-white rounded-[3.5rem] shadow-2xl overflow-hidden border-t-[12px] border-yellow-500">
        <div class="bg-yellow-50 p-8 text-center border-b">
            <div class="text-6xl mb-3">ğŸ“¦</div>
            <h2 class="text-3xl font-black text-yellow-800">Ø³ÙŠØ§Ø±Ø© Ø­Ù…Ù„ ÙˆÙ†Ù‚Ù„</h2>
            <p class="text-xs font-bold text-yellow-600 mt-2">Ø§Ù„Ø³Ø¹Ø±: 1,500 Ø¯ÙŠÙ†Ø§Ø± Ù„ÙƒÙ„ ÙƒÙŠÙ„ÙˆÙ…ØªØ±</p>
        </div>

        <div class="p-8 space-y-6">
            <input type="text" id="cName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full p-4 bg-gray-50 border-2 border-yellow-100 rounded-2xl font-bold outline-none focus:border-yellow-500">
            
            <div id="map" class="shadow-inner"></div>

            <div id="priceInfo" class="hidden bg-slate-900 p-6 rounded-[2rem] text-center text-white">
                <p class="text-xs opacity-70">Ø§Ù„Ù…Ø³Ø§ÙØ©: <span id="distVal">0</span> ÙƒÙ…</p>
                <p class="text-2xl font-black text-yellow-400">Ø§Ù„Ø³Ø¹Ø±: <span id="priceVal">0</span> Ø¯.Ø¹</p>
            </div>

            <button onclick="sendData()" class="w-full bg-yellow-500 text-slate-900 py-5 rounded-2xl font-black text-xl shadow-xl hover:bg-yellow-400">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨</button>
        </div>
    </div>

    <script>
        let map, startMarker, endMarker;
        let dKm = 0, pTotal = 0;

        window.onload = function() {
            map = L.map('map').setView([35.4687, 44.3921], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

            map.on('click', function(e) {
                if (!startMarker) {
                    startMarker = L.marker(e.latlng, {draggable:true}).addTo(map).bindPopup("Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©").openPopup();
                } else if (!endMarker) {
                    endMarker = L.marker(e.latlng, {draggable:true}).addTo(map).bindPopup("Ø§Ù„Ù†Ù‡Ø§ÙŠØ©").openPopup();
                    updateCalc();
                }
                if(startMarker) startMarker.on('dragend', updateCalc);
                if(endMarker) endMarker.on('dragend', updateCalc);
            });
        };

        function updateCalc() {
            if (startMarker && endMarker) {
                const d = map.distance(startMarker.getLatLng(), endMarker.getLatLng()) / 1000;
                dKm = d.toFixed(1);
                pTotal = Math.round(dKm * 1500);
                document.getElementById('priceInfo').classList.remove('hidden');
                document.getElementById('distVal').innerText = dKm;
                document.getElementById('priceVal').innerText = pTotal.toLocaleString();
            }
        }

        function sendData() {
            const name = document.getElementById('cName').value;
            if(!name || !endMarker) return alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ­Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·");
            
            const s = startMarker.getLatLng();
            const e = endMarker.getLatLng();
            // ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø«Ø§Ø¨ØªØ©
            window.location.href = `review.html?service=cargo&car=Ø³ÙŠØ§Ø±Ø© Ø­Ù…Ù„&name=${encodeURIComponent(name)}&dist=${dKm}&price=${pTotal}&slat=${s.lat}&slng=${s.lng}&elat=${e.lat}&elng=${e.lng}&emoji=ğŸ“¦`;
        }
    </script>
</body>
</html>
