<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إتمام الحجز | شركة الحوت</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f4f7fa; }
        .bg-whale { background-color: #002349; }
        .text-gold { color: #D4AF37; }
        .booking-stage { display: none; }
        .booking-stage.active { display: block; animation: fadeInUp 0.5s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .step-item.active .num { background: #D4AF37; color: #002349; box-shadow: 0 0 10px rgba(212,175,55,0.5); }
    </style>
</head>
<body class="py-10 px-4">

    <div class="max-w-5xl mx-auto">
        <div class="flex justify-between items-center mb-10 max-w-lg mx-auto relative">
            <div class="absolute h-1 bg-gray-200 w-full top-5 -z-10"></div>
            <div class="step-item active" id="st1"><div class="num w-10 h-10 rounded-full bg-white border-2 flex items-center justify-center font-bold mx-auto">1</div></div>
            <div class="step-item" id="st2"><div class="num w-10 h-10 rounded-full bg-white border-2 flex items-center justify-center font-bold mx-auto">2</div></div>
            <div class="step-item" id="st3"><div class="num w-10 h-10 rounded-full bg-white border-2 flex items-center justify-center font-bold mx-auto">3</div></div>
        </div>

        <div class="bg-white rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[550px]">
            <div class="flex-1 p-8 md:p-12">
                
                <div class="booking-stage active" id="stage1">
                    <h2 class="text-3xl font-black mb-6 text-whale">تأكيد المركبة المختارة</h2>
                    <div class="p-6 bg-gray-50 border-2 border-gold rounded-3xl mb-8 flex items-center gap-4">
                        <i class="fas fa-car-side text-4xl text-gold"></i>
                        <p class="font-bold">سيارة شخصية (سياحة وعمل)</p>
                    </div>
                    <button onclick="goTo(2)" class="w-full bg-whale text-white py-4 rounded-2xl font-bold">التالي: الإضافات</button>
                </div>

                <div class="booking-stage" id="stage2">
                    <h2 class="text-3xl font-black mb-6 text-whale text-right">الخدمات الإضافية</h2>
                    <div class="space-y-4 mb-8">
                        <label class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl cursor-pointer border-2 border-transparent hover:border-gold transition">
                            <div class="flex items-center gap-3"><i class="fas fa-truck text-gold"></i> <b>توصيل للبيت</b></div>
                            <div class="flex items-center gap-3"><span>10,000 د.ع</span> <input type="checkbox" value="10000" data-name="توصيل" onchange="calcPrice()" class="extra-check w-6 h-6"></div>
                        </label>
                        <label class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl cursor-pointer border-2 border-transparent hover:border-gold transition">
                            <div class="flex items-center gap-3"><i class="fas fa-baby text-gold"></i> <b>كرسي أطفال</b></div>
                            <div class="flex items-center gap-3"><span>10,000 د.ع</span> <input type="checkbox" value="10000" data-name="كرسي أطفال" onchange="calcPrice()" class="extra-check w-6 h-6"></div>
                        </label>
                        <label class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl cursor-pointer border-2 border-transparent hover:border-gold transition">
                            <div class="flex items-center gap-3"><i class="fas fa-user-tie text-gold"></i> <b>سائق خاص</b></div>
                            <div class="flex items-center gap-3"><span>50,000 د.ع</span> <input type="checkbox" value="50000" data-name="سائق خاص" onchange="calcPrice()" class="extra-check w-6 h-6"></div>
                        </label>
                    </div>
                    <button onclick="goTo(3)" class="w-full bg-whale text-white py-4 rounded-2xl font-bold">التالي: بيانات الحجز</button>
                </div>

                <div class="booking-stage" id="stage3">
                    <h2 class="text-3xl font-black mb-6 text-whale">بيانات الزبون والموقع</h2>
                    <div class="space-y-4">
                        <input type="text" id="custName" placeholder="الاسم الثلاثي" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-gold">
                        <input type="tel" id="custPhone" placeholder="رقم الهاتف" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-gold">
                        
                        <div id="personalOnlyFields" class="hidden space-y-4">
                            <input type="text" id="idNumber" placeholder="رقم الهوية الوطنية" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-gold border-gold/30">
                            <input type="text" id="licenseNumber" placeholder="رقم إجازة السوق" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-gold border-gold/30">
                        </div>

                        <textarea id="custAddr" placeholder="العنوان بالتفصيل" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-gold h-28"></textarea>
                        <button onclick="getGPS()" class="w-full py-3 bg-blue-50 text-blue-700 rounded-xl font-bold flex justify-center items-center gap-2"><i class="fas fa-map-pin"></i> تحديد موقعي الحالي</button>
                        <input type="hidden" id="custCoords">
                        <button onclick="submitOrder()" class="w-full bg-green-600 text-white py-5 rounded-2xl font-black text-xl flex justify-center items-center gap-3">تأكيد عبر واتساب <i class="fab fa-whatsapp"></i></button>
                    </div>
                </div>
            </div>

            <div class="w-full md:w-[350px] bg-whale text-white p-10 flex flex-col justify-between">
                <div>
                    <h3 class="text-xl font-bold border-b border-white/10 pb-4 mb-8 text-gold text-right">ملخص الطلب</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between font-bold"><span>نوع الخدمة:</span> <span id="resType">شخصية</span></div>
                        <div class="flex justify-between font-bold text-gray-400"><span>التاريخ:</span> <span id="resDate">-</span></div>
                        <div id="extrasList" class="text-xs text-gold py-2 italic text-right"></div>
                    </div>
                </div>
                <div class="pt-6 border-t border-white/10 flex justify-between items-baseline">
                    <span class="text-xl">الإجمالي:</span>
                    <span id="resTotal" class="text-3xl font-black text-gold">0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let base = 0;
        let currentType = '';

        function goTo(n) {
            document.querySelectorAll('.booking-stage').forEach(s => s.classList.remove('active'));
            document.getElementById('stage'+n).classList.add('active');
            for(let i=1; i<=3; i++) document.getElementById('st'+i).classList.toggle('active', i<=n);
        }

        window.onload = function() {
            const p = new URLSearchParams(window.location.search);
            currentType = p.get('type');
            const date = p.get('date'), pr = p.get('price'), veh = p.get('vehicle');
            
            document.getElementById('resDate').innerText = date || 'غير محدد';

            if (currentType === 'training' || currentType === 'cargo') {
                base = parseInt(pr) || 100000;
                document.getElementById('resType').innerText = (currentType === 'training') ? "تدريب قيادة" : `حمل (${veh})`;
                document.getElementById('personalOnlyFields').classList.add('hidden');
                goTo(3);
            } else {
                base = 50000;
                document.getElementById('resType').innerText = "سيارة شخصية";
                // إظهار حقول الهوية والإجازة لأن الخدمة شخصية
                document.getElementById('personalOnlyFields').classList.remove('hidden');
                goTo(1);
            }
            calcPrice();
        };

        function calcPrice() {
            let extra = 0; let names = [];
            document.querySelectorAll('.extra-check:checked').forEach(c => {
                extra += parseInt(c.value);
                names.push(c.getAttribute('data-name'));
            });
            document.getElementById('resTotal').innerText = (base + extra).toLocaleString() + " د.ع";
            document.getElementById('extrasList').innerText = names.length > 0 ? "مع: " + names.join(' + ') : "";
        }

        function getGPS() {
            if (navigator.geolocation) navigator.geolocation.getCurrentPosition(p => {
                document.getElementById('custCoords').value = p.coords.latitude + "," + p.coords.longitude;
                alert("✅ تم تحديد الموقع!");
            });
        }

        function submitOrder() {
            const name = document.getElementById('custName').value;
            const phone = document.getElementById('custPhone').value;
            const addr = document.getElementById('custAddr').value;
            const total = document.getElementById('resTotal').innerText;
            
            // جلب بيانات الهوية والإجازة إذا كانت الخدمة شخصية
            let personalData = "";
            if (currentType === 'personal') {
                const idNum = document.getElementById('idNumber').value;
                const licNum = document.getElementById('licenseNumber').value;
                if(!idNum || !licNum) { alert("⚠️ يرجى إدخال رقم الهوية ورقم الإجازة"); return; }
                personalData = `%0A*رقم الهوية:* ${idNum}%0A*رقم الإجازة:* ${licNum}`;
            }

            if(!name || !phone || !addr) { alert("⚠️ أكمل البيانات الأساسية أولاً"); return; }
            
            const msg = `*حجز جديد شركة الحوت*%0A---------------------------%0A*الخدمة:* ${document.getElementById('resType').innerText}${personalData}%0A*العميل:* ${name}%0A*الهاتف:* ${phone}%0A*التاريخ:* ${document.getElementById('resDate').innerText}%0A*العنوان:* ${addr}%0A*السعر:* ${total}%0A*موقع GPS:* http://maps.google.com/?q=${document.getElementById('custCoords').value}`;
            
            window.open(`https://wa.me/9647713225471?text=${msg}`, '_blank');
        }
    </script>
</body>
</html>
