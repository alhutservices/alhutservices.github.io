<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØª ğŸ‘‘</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #020617; color: white; }
        .admin-card { background: #0f172a; border-radius: 1.5rem; border-right: 6px solid #D4AF37; }
        .tab-active { background: #D4AF37; color: #020617; font-weight: 900; }
    </style>
</head>
<body class="p-4 pb-20 text-right">

    <header class="mb-6 flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-black text-[#D4AF37]">ØºØ±ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ğŸ”±</h1>
            <p class="text-[10px] text-slate-400">ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ Ø¨Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø­ÙˆØª</p>
        </div>
        <button onclick="loadData()" class="bg-slate-800 p-3 rounded-xl text-xs">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
    </header>

    <div class="flex gap-2 mb-6">
        <button onclick="switchTab('orders')" id="btnO" class="flex-1 py-3 rounded-xl text-xs tab-active">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        <button onclick="switchTab('offices')" id="btnF" class="flex-1 py-3 rounded-xl text-xs bg-slate-800 text-slate-400">Ø§Ù„Ù…ÙƒØ§ØªØ¨</button>
    </div>

    <main id="content" class="space-y-4"></main>

    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbxjkaA9pVrodw8vJcNQnJ2r8yQhIzScsxxj3R_a24Tkyz5V93E0WDwYzyYstI_weXh8/exec";
        let currentTab = 'orders', data = { orders: [], offices: [] };

        async function loadData() {
            try {
                const res = await fetch(`${scriptURL}?action=getAllOrders&t=${Date.now()}`);
                const orders = await res.json();
                // Ù‡Ù†Ø§ Ø¬Ù„Ø¨Ù†Ø§ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ù…ÙƒØ§ØªØ¨ (Ù†ÙØ³ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù…ØµØºØ± ÙŠØ¯Ø¹Ù… Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙ„)
                data.orders = orders;
                // ÙÙŠ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù…ØµØºØ± Ù†Ø­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙƒØ§ØªØ¨ Ù„Ù„Ù…Ø¯ÙŠØ±
                render();
            } catch (e) { document.getElementById('content').innerHTML = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„"; }
        }

        function render() {
            const container = document.getElementById('content');
            if (currentTab === 'orders') {
                container.innerHTML = [...data.orders].reverse().map(o => `
                    <div class="admin-card p-5 mb-4 border-r-4 ${o.status.includes('âœ…') ? 'border-green-500' : 'border-blue-500'}">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[9px] text-slate-500">${o.id}</span>
                            <span class="text-[#D4AF37] font-black">${o.price}</span>
                        </div>
                        <h3 class="text-lg font-bold mb-3">${o.car} - <small class="text-slate-400 text-xs">${o.prov}</small></h3>
                        
                        <div class="bg-slate-900/50 p-3 rounded-xl text-[11px] space-y-1 mb-4">
                            <p>Ø§Ù„Ø²Ø¨ÙˆÙ†: <b class="text-white">${o.name}</b> | <a href="tel:${o.phone}" class="text-green-400 underline">${o.phone}</a></p>
                            <p class="text-blue-400">Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª: <b>${o.addons}</b></p>
                            <p>Ø§Ù„Ù…Ø³ØªÙ„Ù…: <b class="text-orange-400">${o.office || 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙƒØªØ¨'}</b></p>
                        </div>

                        <div class="flex gap-2">
                            <button onclick="action('adminReset', '${o.id}')" class="flex-1 bg-blue-600/20 text-blue-400 py-2 rounded-lg text-[10px] font-bold">Ø¥Ø¹Ø§Ø¯Ø© Ø¥ØªØ§Ø­Ø©</button>
                            <button onclick="action('deleteOrder', '${o.id}')" class="flex-1 bg-red-600/20 text-red-400 py-2 rounded-lg text-[10px] font-bold">Ø­Ø°Ù</button>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = `<p class="text-center py-10 text-slate-500">Ø¬Ø§Ø±ÙŠ ØªØ·ÙˆÙŠØ± Ù‚Ø³Ù… Ø§Ù„Ù…ÙƒØ§ØªØ¨ Ø§Ù„Ù…Ø¨Ø³Ø·...</p>`;
            }
        }

        async function action(act, id) {
            if(!confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ØŸ")) return;
            await fetch(`${scriptURL}?action=${act}&id=${id}`);
            loadData();
        }

        function switchTab(t) {
            currentTab = t;
            document.getElementById('btnO').className = `flex-1 py-3 rounded-xl text-xs ${t==='orders' ? 'tab-active' : 'bg-slate-800 text-slate-400'}`;
            document.getElementById('btnF').className = `flex-1 py-3 rounded-xl text-xs ${t==='offices' ? 'tab-active' : 'bg-slate-800 text-slate-400'}`;
            render();
        }

        loadData();
        setInterval(loadData, 15000);
    </script>
</body>
</html>
