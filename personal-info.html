<script>
// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¥Ù„ÙŠÙƒ
async function sendAutoWhatsAppToAdmin() {
    // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²
    const bookingData = JSON.parse(localStorage.getItem('bookingData')) || {};
    const personalData = {
        name: document.getElementById('name')?.value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
        phone: document.getElementById('phone')?.value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
        email: document.getElementById('email')?.value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'
    };
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
    localStorage.setItem('personalData', JSON.stringify(personalData));
    
    // Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø±Ù…Ø² Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¥Ù„Ù‰ Ø§Ø³Ù…
    function getCarName(carCode) {
        const cars = {
            'camry': 'ØªÙˆÙŠÙˆØªØ§ ÙƒØ§Ù…Ø±ÙŠ 2023',
            'elantra': 'Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ Ø§Ù„Ù†ØªØ±Ø§ 2024',
            'sportage': 'ÙƒÙŠØ§ Ø³Ø¨ÙˆØ±ØªÙŠØ¬ 2023',
            'mercedes': 'Ù…Ø±Ø³ÙŠØ¯Ø³ C200 2022',
            'h1': 'Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ H1 2023',
            'sunny': 'Ù†ÙŠØ³Ø§Ù† ØµÙ†ÙŠ 2023'
        };
        return cars[carCode] || carCode;
    }
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    const bookingNumber = `KRK-${Date.now().toString().slice(-6)}`;
    const message = `ğŸ“‹ *Ø·Ù„Ø¨ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯*
    
ğŸ”¢ *Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²:* ${bookingNumber}
â° *Ø§Ù„ÙˆÙ‚Øª:* ${new Date().toLocaleString('ar-IQ')}

ğŸš— *Ø§Ù„Ø³ÙŠØ§Ø±Ø©:* ${getCarName(bookingData.carType)}
ğŸ“… *Ø§Ù„Ù…Ø¯Ø©:* ${bookingData.days || 1} ÙŠÙˆÙ…
ğŸ’° *Ø§Ù„Ù…Ø¨Ù„Øº:* ${bookingData.totalPrice || '0 Ø¯ÙŠÙ†Ø§Ø±'}
ğŸ“† *Ø§Ù„ØªØ§Ø±ÙŠØ®:* ${bookingData.pickupDate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
â° *Ø§Ù„ÙˆÙ‚Øª:* ${bookingData.pickupTime || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
ğŸ“ *Ø§Ù„Ù…ÙˆÙ‚Ø¹:* ${bookingData.location?.area || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}

ğŸ‘¤ *Ø§Ù„Ø¹Ù…ÙŠÙ„:*
   â€¢ Ø§Ù„Ø§Ø³Ù…: ${personalData.name}
   â€¢ Ø§Ù„Ù‡Ø§ØªÙ: ${personalData.phone}
   â€¢ Ø§Ù„Ø¨Ø±ÙŠØ¯: ${personalData.email}

ğŸ“ *Ù…Ù„Ø§Ø­Ø¸Ø§Øª:* ${bookingData.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯'}

ğŸ“ *Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„:* ${personalData.phone}

_ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ù…ÙˆÙ‚Ø¹ ØªØ£Ø¬ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª_`;
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª API
    const apiKey = '123456'; // Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ù…ÙØªØ§Ø­ CallMeBot Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    const phoneNumber = '9647713225471'; // Ø±Ù‚Ù…Ùƒ
    const text = encodeURIComponent(message);
    
    // Ø±Ø§Ø¨Ø· API
    const apiURL = `https://api.callmebot.com/whatsapp.php?phone=${phoneNumber}&text=${text}&apikey=${apiKey}`;
    
    try {
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (Ø§Ø³ØªØ®Ø¯Ù… no-cors Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„)
        const response = await fetch(apiURL, { mode: 'no-cors' });
        
        console.log('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„');
        return true;
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', error);
        
        // Ø¨Ø¯ÙŠÙ„: Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ ÙŠØ¯ÙˆÙŠ
        createWhatsAppLink(message);
        return false;
    }
}

// Ø¯Ø§Ù„Ø© Ø¨Ø¯ÙŠÙ„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨
function createWhatsAppLink(message) {
    const whatsappURL = `https://wa.me/9647713225471?text=${encodeURIComponent(message)}`;
    window.open(whatsappURL, '_blank');
}

// Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
document.getElementById('personal-info-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
    const personalData = {
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value,
        email: document.getElementById('email').value
    };
    
    localStorage.setItem('personalData', JSON.stringify(personalData));
    
    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨
    await sendAutoWhatsAppToAdmin();
    
    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
    window.location.href = 'confirmation.html';
});
</script>
