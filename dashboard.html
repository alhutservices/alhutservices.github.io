<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…ÙƒØ§ØªØ¨ Ø§Ù„Ø­ÙˆØª ğŸ‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-50 font-['Tajawal'] min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
        <header class="bg-[#002349] text-white p-6 rounded-3xl mb-6 shadow-xl flex justify-between items-center">
            <div>
                <h1 class="text-xl font-black">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙƒØ§ØªØ¨ Ø§Ù„Ø°ÙƒÙŠØ©</h1>
                <p id="cityLabel" class="text-xs text-[#D4AF37]">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</p>
            </div>
            <select id="citySelect" onchange="loadOrders()" class="bg-white text-slate-900 p-2 rounded-xl font-bold">
                <option value="">Ø§Ø®ØªØ± Ù…Ø¯ÙŠÙ†ØªÙƒ</option>
                <option value="ÙƒØ±ÙƒÙˆÙƒ">ÙƒØ±ÙƒÙˆÙƒ</option>
                <option value="Ø¨ØºØ¯Ø§Ø¯">Ø¨ØºØ¯Ø§Ø¯</option>
                <option value="Ø£Ø±Ø¨ÙŠÙ„">Ø£Ø±Ø¨ÙŠÙ„</option>
                <option value="Ø§Ù„Ù…ÙˆØµÙ„">Ø§Ù„Ù…ÙˆØµÙ„</option>
            </select>
        </header>

        <div id="ordersContainer" class="grid gap-4">
            <p class="text-center text-gray-400 mt-10">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹...</p>
        </div>
    </div>

    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbwAVmtBJwIF5TuXuVnz2ifBsuCl9Tj6jJnDdvOxhh1BtIlvb6Csv-uGkuLleYErVk6LUw/exec";

        async function loadOrders() {
            const city = document.getElementById('citySelect').value;
            if(!city) return;
            
            document.getElementById('cityLabel').innerText = "Ø·Ù„Ø¨Ø§Øª Ù…Ø¯ÙŠÙ†Ø©: " + city;
            document.getElementById('ordersContainer').innerHTML = "<p class='text-center'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>";

            const response = await fetch(`${scriptURL}?action=getOrders&city=${encodeURIComponent(city)}`);
            const orders = await response.json();

            let html = '';
            if(orders.length === 0) {
                html = '<p class="text-center text-gray-400 py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
            } else {
                orders.forEach(order => {
                    html += `
                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 flex justify-between items-center">
                        <div>
                            <h3 class="font-black text-lg text-slate-800">${order.car}</h3>
                            <p class="text-sm text-gray-500">Ø§Ù„Ø²Ø¨ÙˆÙ†: ${order.name} | Ø§Ù„Ù…ÙˆØ¹Ø¯: ${order.time}</p>
                        </div>
                        <button onclick="claim('${order.id}')" class="bg-[#002349] text-[#D4AF37] px-6 py-3 rounded-2xl font-black hover:scale-105 transition-all">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
                    </div>`;
                });
            }
            document.getElementById('ordersContainer').innerHTML = html;
        }

        async function claim(id) {
            const office = prompt("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù…ÙƒØªØ¨Ùƒ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:");
            if(!office) return;

            const response = await fetch(`${scriptURL}?action=claim&id=${id}&office=${encodeURIComponent(office)}`);
            const result = await response.text();
            alert(result);
            loadOrders(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        }
    </script>
</body>
</html>

