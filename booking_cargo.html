<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø¬Ø² Ø³ÙŠØ§Ø±Ø© Ø­Ù…Ù„ ğŸš›</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>body { font-family: 'Tajawal', sans-serif; } #mS, #mE { height: 180px; border-radius: 1.5rem; margin: 10px 0; }</style>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-md mx-auto bg-white rounded-[2.5rem] shadow-xl p-6">
        <h2 class="text-2xl font-black text-center mb-6 text-indigo-900">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù‚Ù„ ğŸš›</h2>
        <div class="space-y-4">
            <input type="text" id="n" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full p-4 border-2 rounded-2xl outline-none font-bold">
            <input type="tel" id="ph" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="w-full p-4 border-2 rounded-2xl outline-none font-bold text-left" dir="ltr">
            <input type="text" id="nt" placeholder="ğŸ“¦ Ù…Ø§Ø°Ø§ Ø³Ù†Ù†Ù‚Ù„ØŸ" class="w-full p-4 border-2 rounded-2xl outline-none font-bold">
            
            <p class="font-bold text-sm text-gray-400">ğŸ“ Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</p>
            <div id="mS"></div>
            <p class="font-bold text-sm text-gray-400">ğŸ Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ³Ù„ÙŠÙ…</p>
            <div id="mE"></div>

            <button onclick="rev()" class="w-full bg-indigo-600 text-white py-5 rounded-2xl font-black text-xl shadow-lg">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø­Ø¬Ø²</button>
        </div>
    </div>

    <script>
        let mS, mkS, mE, mkE;
        const urlP = new URLSearchParams(window.location.search);
        const prov = urlP.get('province') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

        window.onload = function() {
            mS = L.map('mS').setView([33.3152, 44.3661], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mS);
            mkS = L.marker([33.3152, 44.3661], {draggable:true}).addTo(mS);

            mE = L.map('mE').setView([33.3152, 44.3661], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mE);
            mkE = L.marker([33.3152, 44.3661], {draggable:true}).addTo(mE);
        };

        function rev() {
            const d = (mkS.getLatLng().distanceTo(mkE.getLatLng()) / 1000).toFixed(1);
            const pr = Math.round(d * 1500);
            const q = `service=cargo&province=${encodeURIComponent(prov)}&name=${encodeURIComponent(document.getElementById('n').value)}&phone=${document.getElementById('ph').value}&notes=${encodeURIComponent(document.getElementById('nt').value)}&dist=${d}&price=${pr}&slat=${mkS.getLatLng().lat}&slng=${mkS.getLatLng().lng}&elat=${mkE.getLatLng().lat}&elng=${mkE.getLatLng().lng}&emoji=ğŸš›`;
            window.location.href = "review.html?" + q;
        }
    </script>
</body>
</html>
