<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø·Ù„Ø¨ Ù†Ù‚Ù„ Ø­Ù…Ù„ | Ø§Ù„Ø­ÙˆØª ğŸ‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f3f4f6; margin: 0; }
        .header-curve { background: #8B5CF6; height: 120px; border-radius: 0 0 40px 40px; position: relative; display: flex; justify-content: center; }
        .icon-circle { background: white; width: 80px; height: 80px; border-radius: 20px; position: absolute; bottom: -40px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 10; }
        .main-container { background: white; margin-top: 50px; border-radius: 40px 40px 0 0; padding: 30px 20px; min-height: 100vh; }
        .gold-input-card { border: 2px solid #FFD700; border-radius: 15px; padding: 10px; background: white; }
        .map-section-card { background: #EFF6FF; border-radius: 30px; padding: 20px; margin-top: 25px; border: 1px solid #dbeafe; }
        .map-frame { height: 220px; border-radius: 20px; border: 2px solid white; z-index: 1; }
        .btn-action { background: #8B5CF6; color: white; width: 100%; padding: 14px; border-radius: 20px; font-weight: 900; }
        
        /* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
        .leaflet-control-geocoder { border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-family: 'Tajawal', sans-serif; }
        .leaflet-control-geocoder-form input { border-radius: 10px; padding: 8px; }
    </style>
</head>
<body>

    <div class="header-curve">
        <div class="icon-circle shadow-xl"><img src="https://cdn-icons-png.flaticon.com/512/411/411763.png" class="w-12" alt="truck"></div>
    </div>

    <div class="main-container">
        <div class="text-center mb-8">
            <h1 class="text-2xl font-black text-gray-800 italic">Ø®Ø¯Ù…Ø© Ù†Ù‚Ù„ Ø§Ù„Ø­ÙˆØª ğŸ‹</h1>
            <p class="text-[10px] text-gray-400 font-bold mt-2 uppercase tracking-widest">ØªØ£ÙƒÙŠØ¯ Ù…Ø³Ø§Ø± Ø§Ù„Ø´Ø­Ù†Ø©</p>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-6">
            <div class="gold-input-card">
                <label class="text-[10px] font-black text-gray-400 block mb-1">ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„</label>
                <input type="text" id="custName" class="w-full border-none outline-none font-bold text-sm bg-transparent">
            </div>
            <div class="gold-input-card">
                <label class="text-[10px] font-black text-gray-400 block mb-1 text-left">ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input type="tel" id="custPhone" class="w-full border-none outline-none font-bold text-sm text-left bg-transparent" dir="ltr">
            </div>
        </div>

        <div class="map-section-card">
            <p class="text-sm font-black text-indigo-900 mb-3 flex items-center gap-2">
                <span class="w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-[10px]">1</span>
                Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ)
            </p>
            <div id="mapStart" class="map-frame shadow-inner"></div>
            <button onclick="getLocation('start')" class="btn-action text-xs mt-3 flex items-center justify-center gap-2 bg-green-600">
                Ø¨Ø« Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ø¢Ù† <i class="fas fa-location-arrow"></i>
            </button>
        </div>

        <div class="map-section-card" style="background: #F5F3FF;">
            <p class="text-sm font-black text-purple-900 mb-3 flex items-center gap-2">
                <span class="w-6 h-6 bg-purple-600 text-white rounded-full flex items-center justify-center text-[10px]">2</span>
                Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ³Ù„ÙŠÙ… (Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙˆØ¬Ù‡Ø©)
            </p>
            <div id="mapEnd" class="map-frame shadow-inner"></div>
            <p class="text-[9px] text-purple-400 mt-2 font-bold">* Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„Ø¨Ø­Ø« ğŸ” Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø£Ø¹Ù„Ø§Ù‡ Ù„ØªØ¬Ø¯ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø¨Ø³Ø±Ø¹Ø©</p>
        </div>

        <div class="mt-10">
            <button onclick="confirmCargo()" class="btn-action text-lg py-5 flex items-center justify-center gap-3 shadow-2xl active:scale-95 transition-all">
                Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨ <i class="fas fa-chevron-left"></i>
            </button>
        </div>
    </div>

    <script>
        let mapStart, markerStart, mapEnd, markerEnd;
        const u = new URLSearchParams(window.location.search);

        window.onload = function() {
            // Ø§Ù„Ø®Ø±ÙŠØ·Ø© 1: Ø¨Ø³ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
            mapStart = L.map('mapStart', {zoomControl: false}).setView([35.4687, 44.3921], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mapStart);
            markerStart = L.marker([35.4687, 44.3921], {draggable: true}).addTo(mapStart);

            // Ø§Ù„Ø®Ø±ÙŠØ·Ø© 2: Ù…Ø¶Ø§Ù Ø¥Ù„ÙŠÙ‡Ø§ Ø£Ø¯Ø§Ø© Ø§Ù„Ø¨Ø­Ø«
            mapEnd = L.map('mapEnd', {zoomControl: false}).setView([35.4687, 44.3921], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mapEnd);
            markerEnd = L.marker([35.4687, 44.3921], {draggable: true}).addTo(mapEnd);

            // Ø¥Ø¶Ø§ÙØ© Ø£Ø¯Ø§Ø© Ø§Ù„Ø¨Ø­Ø« Ù„Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙÙ‚Ø·
            const geocoder = L.Control.geocoder({
                defaultMarkGeocode: false,
                placeholder: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ…...",
                errorMessage: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"
            })
            .on('markgeocode', function(e) {
                const latlng = e.geocode.center;
                mapEnd.setView(latlng, 16);
                markerEnd.setLatLng(latlng);
            })
            .addTo(mapEnd);
        };

        function getLocation(type) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const c = [pos.coords.latitude, pos.coords.longitude];
                    mapStart.setView(c, 16); markerStart.setLatLng(c);
                });
            }
        }

        function confirmCargo() {
            const name = document.getElementById('custName').value;
            const phone = document.getElementById('custPhone').value;
            if(!name || !phone) return alert("Ù„Ø·ÙØ§Ù‹ Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙŠØ§ Ø­ÙˆØª ğŸ‹");

            u.set('name', name); u.set('phone', phone);
            u.set('slat', markerStart.getLatLng().lat); u.set('slng', markerStart.getLatLng().lng);
            u.set('elat', markerEnd.getLatLng().lat); u.set('elng', markerEnd.getLatLng().lng);
            u.set('vehicle', 'Ø³ÙŠØ§Ø±Ø© Ø­Ù…Ù„ ğŸš›');
            
            window.location.href = `review.html?${u.toString()}`;
        }
    </script>
</body>
</html>
