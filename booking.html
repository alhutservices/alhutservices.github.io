<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إتمام الحجز | شركة الحوت</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f4f7fa; }
        .bg-whale { background-color: #002349; }
        .text-gold { color: #D4AF37; }
        .booking-stage { display: none; }
        .booking-stage.active { display: block; animation: fadeInUp 0.5s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .step-item.active .num { background: #D4AF37; color: #002349; box-shadow: 0 0 10px rgba(212,175,55,0.5); }
    </style>
</head>
<body class="py-10 px-4">

    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-10 max-w-lg mx-auto relative px-4 text-center">
            <div class="absolute h-1 bg-gray-200 w-full top-5 -z-10"></div>
            <div class="step-item active" id="st1"><div class="num w-10 h-10 rounded-full bg-white border-2 flex items-center justify-center font-bold mx-auto mb-1">1</div><span class="text-[10px] font-bold">التأكيد</span></div>
            <div class="step-item" id="st2"><div class="num w-10 h-10 rounded-full bg-white border-2 flex items-center justify-center font-bold mx-auto mb-1">2</div><span class="text-[10px] font-bold">الإضافات</span></div>
            <div class="step-item" id="st3"><div class="num w-10 h-10 rounded-full bg-white border-2 flex items-center justify-center font-bold mx-auto mb-1">3</div><span class="text-[10px] font-bold">البيانات</span></div>
        </div>

        <div class="bg-white rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[600px] border border-gray-100">
            
            <div class="flex-1 p-8 md:p-12">
                
                <div class="booking-stage active" id="stage1">
                    <h2 class="text-3xl font-black mb-6 text-whale">تأكيد الحجز</h2>
                    <div class="p-6 bg-gray-50 border-2 border-gold rounded-3xl mb-8 flex items-center gap-4">
                        <i class="fas fa-car-side text-4xl text-gold"></i>
                        <div>
                            <h3 id="display-service-name" class="font-bold text-xl text-whale">تحميل...</h3>
                            <p class="text-gray-500 text-sm">اضغط على زر التالي لتخصيص طلبك</p>
                        </div>
                    </div>
                    <button onclick="goTo(2)" class="w-full bg-whale text-white py-4 rounded-2xl font-bold hover:bg-opacity-90 transition shadow-lg">التالي: الإضافات والكمية</button>
                </div>

                <div class="booking-stage" id="stage2">
                    <h2 class="text-3xl font-black mb-6 text-whale">تخصيص الطلب</h2>
                    
                    <div id="personal-extras-div" class="hidden space-y-4 mb-8">
                        <p class="font-bold text-gray-400 mb-4">إضافات السيارة الشخصية:</p>
                        <label class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl cursor-pointer border-2 border-transparent hover:border-gold transition">
                            <div class="flex items-center gap-3"><i class="fas fa-truck text-gold"></i> <b>توصيل السيارة</b></div>
                            <div class="flex items-center gap-3"><span>10,000 د.ع</span> <input type="checkbox" value="10000" data-name="توصيل" onchange="calcPrice()" class="extra-check w-6 h-6"></div>
                        </label>
                        <label class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl cursor-pointer border-2 border-transparent hover:border-gold transition">
                            <div class="flex items-center gap-3"><i class="fas fa-user-tie text-gold"></i> <b>سائق خاص</b></div>
                            <div class="flex items-center gap-3"><span>50,000 د.ع</span> <input type="checkbox" value="50000" data-name="سائق خاص" onchange="calcPrice()" class="extra-check w-6 h-6"></div>
                        </label>
                    </div>

                    <div id="wedding-extras-div" class="hidden space-y-6 mb-8">
                        <div class="bg-gold/5 p-6 rounded-3xl border-2 border-gold/20">
                            <label class="block text-lg font-black mb-3 text-whale">كم عدد السيارات المطلوبة للزفة؟</label>
                            <div class="flex items-center gap-4">
                                <input type="number" id="car-qty" value="1" min="1" onchange="calcPrice()" class="w-full p-4 rounded-2xl border-2 border-gold outline-none focus:bg-white text-2xl font-black text-center text-whale">
                                <span class="font-bold text-whale text-xl">سيارات</span>
                            </div>
                        </div>
                        <p class="font-bold text-gray-400">إضافات التزيين:</p>
                        <label class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl cursor-pointer border-2 border-transparent hover:border-gold transition">
                            <div class="flex items-center gap-3"><i class="fas fa-fan text-gold"></i> <b>تزيين ورد طبيعي كامل</b></div>
                            <div class="flex items-center gap-3"><span>75,000 د.ع</span> <input type="checkbox" value="75000" data-name="ورد طبيعي" onchange="calcPrice()" class="extra-check w-6 h-6"></div>
                        </label>
                    </div>

                    <button onclick="goTo(3)" class="w-full bg-whale text-white py-4 rounded-2xl font-bold shadow-lg">التالي: بيانات الزبون</button>
                </div>

                <div class="booking-stage" id="stage3">
                    <h2 class="text-3xl font-black mb-6 text-whale">معلومات الحجز الموقع</h2>
                    <div class="space-y-4">
                        <input type="text" id="cust-name" placeholder="الاسم الكامل" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-gold font-bold">
                        <input type="tel" id="cust-phone" placeholder="رقم الهاتف" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-gold font-bold text-right" dir="ltr">
                        
                        <div id="legal-inputs" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="relative">
                                <i class="fas fa-id-card absolute right-4 top-5 text-gray-300"></i>
                                <input type="text" id="id-number" placeholder="رقم الهوية / جواز السفر" class="w-full p-4 pr-12 bg-gray-50 border-2 border-gold/20 rounded-2xl outline-none focus:border-gold font-bold">
                            </div>
                            <div class="relative">
                                <i class="fas fa-id-badge absolute right-4 top-5 text-gray-300"></i>
                                <input type="text" id="license-number" placeholder="رقم إجازة السوق" class="w-full p-4 pr-12 bg-gray-50 border-2 border-gold/20 rounded-2xl outline-none focus:border-gold font-bold">
                            </div>
                        </div>

                        <textarea id="cust-address" placeholder="العنوان بالتفصيل في كركوك" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-gold h-28 font-bold"></textarea>
                        
                        <button onclick="getGPS()" class="w-full py-3 bg-blue-50 text-blue-700 rounded-xl font-bold flex justify-center items-center gap-2 border border-blue-100 hover:bg-blue-100 transition">
                            <i class="fas fa-map-marker-alt"></i> تحديد موقعي الحالي عبر GPS
                        </button>
                        <input type="hidden" id="cust-coords">
                        
                        <button onclick="sendOrder()" class="w-full bg-green-600 text-white py-5 rounded-2xl font-black text-xl flex justify-center items-center gap-3 shadow-2xl hover:scale-[1.02] transition-transform">
                            تأكيد الحجز عبر واتساب <i class="fab fa-whatsapp"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="w-full md:w-[380px] bg-whale text-white p-10 flex flex-col justify-between border-r border-white/5">
                <div>
                    <h3 class="text-xl font-bold border-b border-white/10 pb-4 mb-8 text-gold flex items-center gap-2">
                        <i class="fas fa-receipt"></i> تفاصيل الفاتورة
                    </h3>
                    <div class="space-y-5">
                        <div class="flex justify-between"><span class="opacity-60">الخدمة:</span> <span id="summary-service" class="font-bold">-</span></div>
                        <div class="flex justify-between"><span class="opacity-60">التاريخ:</span> <span id="summary-date" class="font-bold">-</span></div>
                        <div id="summary-extras" class="text-xs text-gold font-bold bg-white/5 p-3 rounded-xl hidden"></div>
                    </div>
                </div>
                <div class="pt-6 border-t border-white/10">
                    <p class="text-sm opacity-50 mb-1 font-bold">المبلغ المطلوب:</p>
                    <span id="summary-total" class="text-4xl font-black text-gold">0 د.ع</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let basePrice = 0;
        let serviceType = '';

        // وظيفة التنقل بين المراحل
        function goTo(n) {
            document.querySelectorAll('.booking-stage').forEach(s => s.classList.remove('active'));
            document.getElementById('stage' + n).classList.add('active');
            for(let i=1; i<=3; i++) {
                const step = document.getElementById('st' + i);
                if(i <= n) step.classList.add('active'); else step.classList.remove('active');
            }
            window.scrollTo(0,0);
        }

        // عند تحميل الصفحة مباشرة
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            serviceType = urlParams.get('type');
            const date = urlParams.get('date');
            const price = urlParams.get('price');
            const vehicle = urlParams.get('vehicle');

            document.getElementById('summary-date').innerText = date || 'غير محدد';

            // المنطق البرمجي لفرز الخدمات
            if (serviceType === 'personal') {
                basePrice = 50000; // سعر افتراضي
                document.getElementById('summary-service').innerText = "سيارة شخصية";
                document.getElementById('display-service-name').innerText = "سيارة شخصية";
                document.getElementById('personal-extras-div').classList.remove('hidden');
                document.getElementById('legal-inputs').classList.remove('hidden'); // إظهار الهوية والإجازة
                goTo(1);
            } 
            else if (serviceType === 'wedding') {
                basePrice = 100000; // سعر افتراضي لسيارة العرس
                document.getElementById('summary-service').innerText = "سيارات مزينة (زفة)";
                document.getElementById('display-service-name').innerText = "سيارات حفلات ومناسبات";
                document.getElementById('wedding-extras-div').classList.remove('hidden');
                document.getElementById('legal-inputs').classList.remove('hidden'); // إظهار الهوية والإجازة
                goTo(1);
            }
            else {
                // تعليم السياقة أو سيارات الحمل
                basePrice = parseInt(price) || 0;
                document.getElementById('summary-service').innerText = (serviceType === 'training') ? "تعليم قيادة" : `حمل (${vehicle})`;
                document.getElementById('display-service-name').innerText = document.getElementById('summary-service').innerText;
                document.getElementById('legal-inputs').classList.add('hidden'); // إخفاء الهوية والإجازة
                goTo(3); // قفز مباشر للمرحلة 3 بنفس التصميم الفخم
            }
            calcPrice();
        };

        // وظيفة حساب السعر
        function calcPrice() {
            let extra = 0; 
            let names = [];
            const qtyInput = document.getElementById('car-qty');
            const qty = (serviceType === 'wedding' && qtyInput) ? parseInt(qtyInput.value) || 1 : 1;
            
            document.querySelectorAll('.extra-check:checked').forEach(c => {
                extra += parseInt(c.value);
                names.push(c.getAttribute('data-name'));
            });

            const total = (basePrice * qty) + extra;
            document.getElementById('summary-total').innerText = total.toLocaleString() + " د.ع";
            
            const summaryExtras = document.getElementById('summary-extras');
            let listText = (serviceType === 'wedding') ? `العدد: ${qty} سيارة` : "";
            if(names.length > 0) listText += (listText ? " | " : "") + "إضافات: " + names.join(' + ');
            
            if(listText) {
                summaryExtras.innerText = listText;
                summaryExtras.classList.remove('hidden');
            } else {
                summaryExtras.classList.add('hidden');
            }
        }

        // وظيفة الموقع
        function getGPS() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    document.getElementById('cust-coords').value = p.coords.latitude + "," + p.coords.longitude;
                    alert("✅ تم تحديد إحداثيات موقعك");
                });
            }
        }

        // وظيفة الإرسال النهائية
        function sendOrder() {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const addr = document.getElementById('cust-address').value;
            const total = document.getElementById('summary-total').innerText;
            const details = document.getElementById('summary-extras').innerText;

            if(!name || !phone || !addr) { alert("⚠️ يرجى ملء الاسم والهاتف والعنوان"); return; }

            let legalData = "";
            if (serviceType === 'personal' || serviceType === 'wedding') {
                const id = document.getElementById('id-number').value;
                const lic = document.getElementById('license-number').value;
                if(!id || !lic) { alert("⚠️ مطلوب رقم الهوية ورقم الإجازة لهذه الخدمة"); return; }
                legalData = `%0A*رقم الهوية:* ${id}%0A*رقم الإجازة:* ${lic}`;
            }

            const msg = `*طلب حجز - شركة الحوت*%0A---------------------------%0A*الخدمة:* ${document.getElementById('summary-service').innerText}${legalData}%0A*العميل:* ${name}%0A*الهاتف:* ${phone}%0A*التاريخ:* ${document.getElementById('summary-date').innerText}%0A*العنوان:* ${addr}%0A*التفاصيل:* ${details}%0A*الإجمالي:* ${total}%0A*الموقع:* http://maps.google.com/maps?q=${document.getElementById('cust-coords').value}`;
            
            window.open(`https://wa.me/9647713225471?text=${msg}`, '_blank');
        }
    </script>
</body>
</html>
