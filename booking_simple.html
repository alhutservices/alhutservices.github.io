<script>
    let uprice = 0, map, marker;

    window.onload = function() {
        const p = new URLSearchParams(window.location.search);
        uprice = parseInt(p.get('price')) || 0;
        document.getElementById('stype').innerText = p.get('vehicle') || "غير محدد";
        recalc();

        const kirkuk = [35.4687, 44.3921];
        map = L.map('map').setView(kirkuk, 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        marker = L.marker(kirkuk, {draggable: true}).addTo(map);
        
        // تفعيل الـ GPS التلقائي فوراً
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(pos) {
                const lat = pos.coords.latitude;
                const lng = pos.coords.longitude;
                map.setView([lat, lng], 16);
                marker.setLatLng([lat, lng]);
                document.getElementById('scoords').value = lat + "," + lng;
            });
        }

        marker.on('dragend', function() {
            const pos = marker.getLatLng();
            document.getElementById('scoords').value = pos.lat + "," + pos.lng;
        });
        document.getElementById('scoords').value = kirkuk[0] + "," + kirkuk[1];
    };
    
    // ... باقي دالة الحساب والإرسال كما هي ...
</script>
